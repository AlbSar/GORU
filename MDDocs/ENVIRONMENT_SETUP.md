# GORU ERP Backend - Environment Setup Dok√ºmantasyonu

## üìã ƒ∞√ßindekiler

1. [Sistem Gereksinimleri](#sistem-gereksinimleri)
2. [Kurulum Adƒ±mlarƒ±](#kurulum-adƒ±mlarƒ±)
3. [Environment Variables](#environment-variables)
4. [Database Kurulumu](#database-kurulumu)
5. [Docker Kurulumu](#docker-kurulumu)
6. [Development Setup](#development-setup)
7. [Production Setup](#production-setup)
8. [Troubleshooting](#troubleshooting)

## üíª Sistem Gereksinimleri

### Minimum Gereksinimler
- **Python**: 3.11+ (3.13.5 √∂nerilen)
- **PostgreSQL**: 15+ (development i√ßin SQLite da kullanƒ±labilir)
- **Docker**: 20.10+ (opsiyonel)
- **Git**: 2.30+

### √ñnerilen Gereksinimler
- **RAM**: 4GB+ (development), 8GB+ (production)
- **CPU**: 2+ cores (development), 4+ cores (production)
- **Disk**: 10GB+ bo≈ü alan
- **OS**: Linux/macOS/Windows 10+

## üöÄ Kurulum Adƒ±mlarƒ±

### 1. Repository Klonlama
```bash
# Repository'yi klonla
git clone https://github.com/AlbSar/GORU.git
cd GORU

# Branch kontrol√º
git branch
git checkout main
```

### 2. Python Environment Kurulumu
```bash
# Python versiyonunu kontrol et
python --version  # 3.11+ olmalƒ±

# Virtual environment olu≈ütur
python -m venv venv

# Virtual environment'ƒ± aktifle≈ütir
# Windows
venv\Scripts\activate

# Linux/macOS
source venv/bin/activate

# Baƒüƒ±mlƒ±lƒ±klarƒ± y√ºkle
cd backend
pip install -r requirements.txt
```

### 3. Environment Dosyasƒ± Olu≈üturma
```bash
# Root dizine d√∂n
cd ..

# Environment dosyasƒ±nƒ± kopyala
cp env.example .env

# .env dosyasƒ±nƒ± d√ºzenle
# Windows
notepad .env

# Linux/macOS
nano .env
```

## üîß Environment Variables

### Temel Ayarlar
```env
# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================
APP_ENV=development
ENVIRONMENT=development
DEBUG=true
LOG_LEVEL=debug

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================
SECRET_KEY=your-super-secret-key-change-in-production
JWT_SECRET_KEY=your-jwt-secret-key-change-in-production
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
# PostgreSQL (Production)
DATABASE_URL=postgresql://username:password@localhost:5432/goru_db
TEST_DATABASE_URL=postgresql://username:password@localhost:5432/goru_test_db

# SQLite (Development/Test)
DEV_DATABASE_URL=sqlite:///./dev.db
TEST_SQLITE_URL=sqlite:///./test.db

# =============================================================================
# CORS CONFIGURATION
# =============================================================================
BACKEND_CORS_ORIGINS=["http://localhost:3000", "http://localhost:8080"]

# =============================================================================
# MIDDLEWARE CONFIGURATION
# =============================================================================
ENABLE_SECURITY_HEADERS=true
ENABLE_RATE_LIMITING=true
ENABLE_LOGGING_MIDDLEWARE=true
DEFAULT_RATE_LIMIT=60
BURST_RATE_LIMIT=120
RATE_LIMIT_WINDOW=60

# =============================================================================
# MOCK SYSTEM CONFIGURATION
# =============================================================================
USE_MOCK=false
MOCK_API_PREFIX=/mock

# =============================================================================
# API CONFIGURATION
# =============================================================================
API_V1_STR=/api/v1
PROJECT_NAME=GORU ERP Backend
VALID_TOKEN=test-token-12345
```

### Production Ayarlarƒ±
```env
# Production i√ßin deƒüi≈ütirilmesi gerekenler
APP_ENV=production
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=info

# G√ºvenli secret key'ler
SECRET_KEY=your-production-secret-key-here
JWT_SECRET_KEY=your-production-jwt-secret-key-here

# Production database
DATABASE_URL=postgresql://prod_user:prod_password@prod_host:5432/goru_prod_db

# Production CORS
BACKEND_CORS_ORIGINS=["https://yourdomain.com", "https://api.yourdomain.com"]

# Production middleware
ENABLE_SECURITY_HEADERS=true
ENABLE_RATE_LIMITING=true
DEFAULT_RATE_LIMIT=100
BURST_RATE_LIMIT=200

# Mock system kapalƒ±
USE_MOCK=false
```

## üóÑÔ∏è Database Kurulumu

### PostgreSQL Kurulumu

#### Windows
```bash
# PostgreSQL indir ve kur
# https://www.postgresql.org/download/windows/

# PostgreSQL servisini ba≈ülat
net start postgresql-x64-15

# psql ile baƒülan
psql -U postgres

# Database olu≈ütur
CREATE DATABASE goru_db;
CREATE DATABASE goru_test_db;
CREATE USER goru_user WITH PASSWORD 'goru_password';
GRANT ALL PRIVILEGES ON DATABASE goru_db TO goru_user;
GRANT ALL PRIVILEGES ON DATABASE goru_test_db TO goru_user;
```

#### Linux (Ubuntu/Debian)
```bash
# PostgreSQL kur
sudo apt update
sudo apt install postgresql postgresql-contrib

# PostgreSQL servisini ba≈ülat
sudo systemctl start postgresql
sudo systemctl enable postgresql

# PostgreSQL kullanƒ±cƒ±sƒ±na ge√ß
sudo -u postgres psql

# Database olu≈ütur
CREATE DATABASE goru_db;
CREATE DATABASE goru_test_db;
CREATE USER goru_user WITH PASSWORD 'goru_password';
GRANT ALL PRIVILEGES ON DATABASE goru_db TO goru_user;
GRANT ALL PRIVILEGES ON DATABASE goru_test_db TO goru_user;
```

#### macOS
```bash
# Homebrew ile PostgreSQL kur
brew install postgresql

# PostgreSQL servisini ba≈ülat
brew services start postgresql

# Database olu≈ütur
createdb goru_db
createdb goru_test_db
```

### SQLite Kurulumu (Development)
```bash
# SQLite genellikle Python ile birlikte gelir
# Ek kurulum gerekmez

# Database dosyalarƒ± otomatik olu≈üturulur
# dev.db ve test.db dosyalarƒ± backend/ klas√∂r√ºnde olu≈üur
```

### Database Migration
```bash
# Backend klas√∂r√ºne ge√ß
cd backend

# Alembic migration'larƒ± √ßalƒ±≈ütƒ±r
alembic upgrade head

# Test database i√ßin migration
python -m pytest app/tests/test_database_coverage.py -v
```

## üê≥ Docker Kurulumu

### Docker Compose ile Kurulum
```bash
# Docker Compose dosyasƒ±nƒ± kontrol et
cat docker-compose.yml

# Servisleri ba≈ülat
docker-compose up --build

# Arka planda √ßalƒ±≈ütƒ±r
docker-compose up -d --build

# Servisleri durdur
docker-compose down

# Loglarƒ± g√∂r√ºnt√ºle
docker-compose logs -f
```

### Docker Compose Override
```bash
# Development override
cat docker-compose.override.yml

# Production override
cat docker-compose.prod.yml
```

### Manuel Docker Kurulumu
```bash
# Backend image'ƒ±nƒ± build et
docker build -t goru-backend:latest backend/

# Container'ƒ± √ßalƒ±≈ütƒ±r
docker run -d \
  --name goru-backend \
  -p 8000:8000 \
  -e DATABASE_URL=postgresql://goru_user:goru_password@host.docker.internal:5432/goru_db \
  goru-backend:latest

# Container loglarƒ±nƒ± g√∂r√ºnt√ºle
docker logs -f goru-backend

# Container'a baƒülan
docker exec -it goru-backend bash
```

## üîß Development Setup

### Local Development
```bash
# Virtual environment'ƒ± aktifle≈ütir
# Windows
venv\Scripts\activate

# Linux/macOS
source venv/bin/activate

# Backend klas√∂r√ºne ge√ß
cd backend

# Baƒüƒ±mlƒ±lƒ±klarƒ± y√ºkle
pip install -r requirements.txt

# Development server'ƒ± ba≈ülat
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# Alternatif olarak
python -m uvicorn app.main:app --reload
```

### Development Environment Variables
```env
# Development i√ßin .env
APP_ENV=development
DEBUG=true
LOG_LEVEL=debug

# SQLite kullan (development i√ßin)
DATABASE_URL=sqlite:///./dev.db
TEST_DATABASE_URL=sqlite:///./test.db

# Mock system a√ßƒ±k (development i√ßin)
USE_MOCK=true

# CORS ayarlarƒ±
BACKEND_CORS_ORIGINS=["http://localhost:3000", "http://localhost:8080", "http://127.0.0.1:3000"]

# Rate limiting gev≈üek
DEFAULT_RATE_LIMIT=1000
BURST_RATE_LIMIT=2000
```

### Development Tools
```bash
# Linting
black backend/app/ --line-length 88
isort backend/app/ --profile black
flake8 backend/app/
ruff check backend/app/

# Pre-commit hooks
pre-commit install
pre-commit run --all-files

# Test √ßalƒ±≈ütƒ±rma
python -m pytest --cov=app --cov-report=term-missing

# Coverage raporu
python -m pytest --cov=app --cov-report=html
# htmlcov/index.html dosyasƒ±nƒ± a√ß
```

## üöÄ Production Setup

### Production Environment Variables
```env
# Production i√ßin .env
APP_ENV=production
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=info

# PostgreSQL kullan
DATABASE_URL=postgresql://prod_user:prod_password@prod_host:5432/goru_prod_db

# Mock system kapalƒ±
USE_MOCK=false

# G√ºvenlik ayarlarƒ±
ENABLE_SECURITY_HEADERS=true
ENABLE_RATE_LIMITING=true
DEFAULT_RATE_LIMIT=60
BURST_RATE_LIMIT=120

# CORS ayarlarƒ±
BACKEND_CORS_ORIGINS=["https://yourdomain.com"]
```

### Production Deployment
```bash
# Docker ile production
docker-compose -f docker-compose.prod.yml up -d

# Manuel production deployment
docker build -t goru-backend:prod backend/
docker run -d \
  --name goru-backend-prod \
  -p 8000:8000 \
  -e DATABASE_URL=postgresql://prod_user:prod_password@prod_host:5432/goru_prod_db \
  -e APP_ENV=production \
  -e DEBUG=false \
  goru-backend:prod
```

### Production Monitoring
```bash
# Health check
curl http://localhost:8000/health

# API docs
curl http://localhost:8000/docs

# Logs
docker logs -f goru-backend-prod

# Metrics
curl http://localhost:8000/metrics
```

## üß™ Test Environment

### Test Database Setup
```bash
# Test database olu≈ütur
createdb goru_test_db

# Test environment variables
export TEST_DATABASE_URL=postgresql://goru_user:goru_password@localhost:5432/goru_test_db
export TEST_SQLITE_URL=sqlite:///./test.db

# Test √ßalƒ±≈ütƒ±r
python -m pytest --cov=app --cov-report=term-missing

# Belirli test dosyalarƒ±nƒ± √ßalƒ±≈ütƒ±r
python -m pytest app/tests/test_users_fixed.py -v
python -m pytest app/tests/test_stocks_fixed.py -v
python -m pytest app/tests/test_orders.py -v
```

### Test Environment Variables
```env
# Test i√ßin .env.test
APP_ENV=test
DEBUG=true
LOG_LEVEL=debug

# Test database
DATABASE_URL=sqlite:///./test.db
TEST_DATABASE_URL=sqlite:///./test.db

# Mock system a√ßƒ±k
USE_MOCK=true

# Test ayarlarƒ±
ENABLE_SECURITY_HEADERS=false
ENABLE_RATE_LIMITING=false
```

## üîç Troubleshooting

### Yaygƒ±n Sorunlar

#### 1. Import Hatalarƒ±
```bash
# Hata: ImportError: cannot import name 'ALGORITHM' from 'app.auth'
# √á√∂z√ºm: Import path'lerini d√ºzelt
# app/tests/test_auth_error_handling.py dosyasƒ±nƒ± g√ºncelle
```

#### 2. Database Baƒülantƒ± Sorunlarƒ±
```bash
# Hata: Connection refused
# √á√∂z√ºm: PostgreSQL servisini ba≈ülat
sudo systemctl start postgresql  # Linux
net start postgresql-x64-15      # Windows
brew services start postgresql    # macOS

# Hata: Database does not exist
# √á√∂z√ºm: Database olu≈ütur
createdb goru_db
createdb goru_test_db
```

#### 3. Port √áakƒ±≈ümasƒ±
```bash
# Hata: Address already in use
# √á√∂z√ºm: Port'u deƒüi≈ütir
uvicorn app.main:app --reload --port 8001

# Veya mevcut process'i bul ve durdur
lsof -i :8000
kill -9 <PID>
```

#### 4. Permission Sorunlarƒ±
```bash
# Hata: Permission denied
# √á√∂z√ºm: Dosya izinlerini d√ºzelt
chmod +x backend/scripts/*.py
chmod 755 backend/
```

#### 5. Virtual Environment Sorunlarƒ±
```bash
# Hata: Module not found
# √á√∂z√ºm: Virtual environment'ƒ± aktifle≈ütir
source venv/bin/activate  # Linux/macOS
venv\Scripts\activate     # Windows

# Veya yeniden olu≈ütur
rm -rf venv
python -m venv venv
source venv/bin/activate
pip install -r backend/requirements.txt
```

### Debug Komutlarƒ±
```bash
# Python versiyonu kontrol et
python --version

# Virtual environment kontrol et
which python
pip list

# Database baƒülantƒ±sƒ±nƒ± test et
python backend/test_db.py

# Environment variables kontrol et
python -c "import os; print(os.environ.get('DATABASE_URL'))"

# Port kullanƒ±mƒ±nƒ± kontrol et
netstat -tulpn | grep :8000

# Docker container durumu
docker ps
docker logs <container_name>
```

### Log Dosyalarƒ±
```bash
# Application logs
tail -f backend/logs/app.log

# Docker logs
docker logs -f goru-backend

# System logs
journalctl -u postgresql -f  # Linux
```

## üìä Monitoring ve Logging

### Health Check Endpoints
```bash
# Health check
curl http://localhost:8000/health

# API docs
curl http://localhost:8000/docs

# Metrics
curl http://localhost:8000/metrics
```

### Logging Konfig√ºrasyonu
```python
# backend/app/core/settings.py
LOG_LEVEL = "debug"  # development
LOG_LEVEL = "info"   # production

# Log format
LOG_FORMAT = "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
```

### Performance Monitoring
```bash
# Memory kullanƒ±mƒ±
docker stats goru-backend

# CPU kullanƒ±mƒ±
top -p $(pgrep -f uvicorn)

# Database baƒülantƒ±larƒ±
psql -U goru_user -d goru_db -c "SELECT * FROM pg_stat_activity;"
```

---

**Son G√ºncelleme:** G√ºncel  
**Environment:** Development/Production  
**Database:** PostgreSQL/SQLite  
**Docker:** Supported  
**Python:** 3.11+ 